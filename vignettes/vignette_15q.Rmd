---
title: "Analysis of 15q data"
output: github_document
---

# CRMetrics class


## Initializing a CRMetrics class

Load the library

```{r setup}
library(CRMetrics)
```

We need to do the annotation of condition and age manually. 
All samples where no age is specified in sample name are assigned to P60. 
We are lacking sex information. 

```{r}
metadata_15q_cr <- c(
  c("AAM10_P15q15", "15q", "P15"),
  c("AAM10_P15wt", "wt", "P15"),
  c("AAM11_15Qa", "15q", "P60"),
  c("AAM11_15Qb", "15q", "P60"),
  c("AAM11_wta", "wt", "P60"),
  c("AAM11_wtb", "wt", "P60"),
  c("AAM12_15qa", "15q", "P60"),
  c("AAM12_15qb", "15q", "P60"),
  c("AAM12_wta", "wt", "P60"),
  c("AAM12_wtb", "wt", "P60"),
  c("AAM1_P15q15", "15q", "P15"),
  c("AAM1_P60q15", "15q", "P60"),
  c("AAM3_P15wt", "wt", "P15"),
  c("AAM3_P60wt", "wt", "P60"),
  c("AAM8_P60q15", "15q", "P60"),
  c("AAM8_P60wt", "wt", "P60")
)
```

Format and save metadata as csv. 

```{r eval=F}
metadata_15q_cr <- data.frame(matrix(data = metadata_15q_cr, ncol = 3, byrow = TRUE))
colnames(metadata_15q_cr) <- c("sample", "condition", "age")
# write.csv(metadata_15q_cr, "../data/metadata_15q_CRMetrics.csv", row.names = F)
```

Initialize a new object of class `CRMetrics` with the path to the Cell Ranger output and a metadata file. 
The metadata file contains a column `sample` with the samples and optionally more columns with factors. 

```{r}
crm <- CRMetrics$new(data_path = "/data/15q/counts_premrna/", 
                               metadata_file = "/people/szr214/CRMetrics/data/metadata_15q_CRMetrics.csv")
```


```{r}
crm$plotMedianUmi(comp_group = "condition")
crm$plotMedianUmi(comp_group = "age")
```

```{r}
crm$addDetailedMetrics()
```


```{r}
crm$plotGeneCounts(comp_group = "condition")
crm$plotUmiCounts(comp_group = "condition")
```

```{r}
crm$plotUMAP(cutoff_depth=1e3)
```


